---
title: "Data Question 4"
author: "Skirmish Guards (Vinay, Shruti, & James)"
date: "February 3rd, 2018"
output:
  html_document:
    theme: united
    highlight: tango
---

### Intro: R Packages Utilized

```{r, message = FALSE, warning = FALSE}
library("tidyverse")
library("readxl")
library("dplyr")
library("magrittr")
library("ggplot2")
library("GGally")
library("broom")
library("plyr")
library("ggmap")
library("maps")
library("mapdata")
library("rgeos")
library("maptools")
library("sp")
library("raster")
library("rgdal")
library("sf")
library("broom")
library("stringr")
```

### Where did the data come from? 

* Academic, demographic, and disciplinary education data gathered from [the 2014 - 2015 TN.gov] (https://www.tn.gov/education/data/data-downloads.html)
* [Zip Codes] (https://www.unitedstateszipcodes.org/zip-code-database/)
* Organizes zipcodes by county. 
* [2011 - 2015 IRS Data] (https://www.irs.gov/statistics/soi-tax-stats-individual-income-tax-statistics-zip-code-data-soi)
* Aggregated tax infomration organized by zipcode. 


### Correlation Matrix of Averaged IRS Data

```{r}
irs <- read.csv("data/irs_avg.csv")

ggcorr(irs)


```

### Correlation Matrix of CORE Education Data

```{r warning=FALSE, message=FALSE}
edu_raw <- read.csv("data/achievement_profile_data_with_CORE.csv")
View(edu_raw)

edu_2 <- dplyr::select(edu_raw, system_name,BioI,Chemistry,ELA,EngI,EngII,EngIII,AlgI,AlgII,Math,Science,ACT_Composite,Graduation,Pct_Native_American,Pct_SWD,
                Pct_Black,Pct_Hispanic,Pct_EL,Pct_ED,Pct_BHN,Pct_Chronically_Absent,
                Pct_Suspended,Pct_Expelled,Per_Pupil_Expenditures,Enrollment
)
ggcorr(edu_2)

```

### Average Science 

```{r}
usa <- map_data("usa")
states <- map_data("state")
tn_df <- subset(states, region == "tennessee")
counties <- map_data("county")
tn_counties <- subset(counties, region == "tennessee")

tn_base <- ggplot(data = tn_df, mapping = aes(x = long, y = lat, group = group)) + 
  coord_fixed(1.3) + 
  geom_polygon(color = "black", fill = "gray")
tn_base + theme_nothing()

#I need to be able to merge these two to create the ggmap

core <- read.csv("data/merged_county.csv")
colnames(core)[2] <- "subregion" #renaming to match
core[[2]] <- tolower(core[[2]]) #changing to all lowercase

#removing 'county' from the column

core$subregion <- gsub(" county$", "", core$subregion)

#merging the two dataframes together with nnner_join

tn_core <- inner_join(tn_counties, core, by = "subregion")

#Attempting to plot

ditch_the_axes <- theme(
  axis.text = element_blank(),
  axis.line = element_blank(),
  axis.ticks = element_blank(),
  panel.border = element_blank(),
  panel.grid = element_blank(),
  axis.title = element_blank()
)

tn_per_pupil <- tn_base + 
  geom_polygon(data = tn_core, aes(fill = Per_Pupil_Expenditures), color = "white") +
  geom_polygon(color = "black", fill = NA) +
  theme_bw() +
  ditch_the_axes

tn_per_pupil
```


```{r}
tn_eng <- tn_base + 
  geom_polygon(data = tn_core, aes(fill = avg_Eng), color = "white") +
  geom_polygon(color = "black", fill = NA) +
  theme_bw() +
  scale_fill_gradientn(colours = rev(rainbow(7)),
                       breaks = c(50, 65, 75, 85, 95, 100)) +
  ditch_the_axes

tn_eng
```

```{r}
tn_math <- tn_base + 
  geom_polygon(data = tn_core, aes(fill = avg_Math), color = "white") +
  geom_polygon(color = "black", fill = NA) +
  theme_bw() +
  scale_fill_gradientn(colours = rev(rainbow(7)),
                       breaks = c(50, 65, 75, 85, 95, 100)) +
  ditch_the_axes

tn_math
```

```{r}
tn_per_pupil <- tn_base + 
  geom_polygon(data = tn_core, aes(fill = Per_Pupil_Expenditures), color = "white") +
  geom_polygon(color = "black", fill = NA) +
  theme_bw() +
  ditch_the_axes

tn_per_pupil
```


